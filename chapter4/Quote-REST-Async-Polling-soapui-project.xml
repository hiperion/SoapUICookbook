<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="d1e9f36b-8aaa-43b4-ab98-1541181a7b6e" activeEnvironment="Default" name="Quote REST Async Polling" resourceRoot="" soapui-version="5.0.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" id="cf82a715-f717-4d7b-93f5-84ab0107d975" wadlVersion="http://wadl.dev.java.net/2009/02" name="http://localhost:8080" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>http://bear-software-macpro.home:8080/</con:endpoint><con:endpoint>http://localhost:8080</con:endpoint></con:endpoints><con:resource name="quote" path="/quote/{id}" id="0d0d77cd-d301-433a-8e74-ad1a879ae3a7"><con:settings/><con:parameters><con:parameter><con:name>id</con:name><con:value>12345</con:value><con:style>TEMPLATE</con:style><con:default>12345</con:default><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="getQuote" method="GET" id="9cccbdb0-6195-4cd6-b639-e0fa8fa0d171"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/xml</con:mediaType><con:status>200</con:status><con:params/><con:element>quote</con:element></con:representation><con:representation type="FAULT"><con:mediaType>application/xml</con:mediaType><con:status>404</con:status><con:params/></con:representation><con:request name="GetQuoteRequest" mediaType="application/json" id="f4e06906-8bfd-4b38-a70b-e04788cbb8b0"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://bear-software-macpro.home:8080/</con:endpoint><con:request/><con:originalUri>http://bear-software-macpro.home/quote/12345</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="Q294415" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:request></con:method></con:resource><con:resource name="quote-task" path="/quote/task/{id}" id="8a4344fe-3ed3-4d4e-af7b-5309e5750fe7"><con:settings/><con:parameters><con:parameter><con:name>id</con:name><con:value/><con:style>TEMPLATE</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="getQuoteStatus" method="GET" id="c0b05e49-2012-44c5-9071-8c83e0bbee89"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType>application/xml</con:mediaType><con:status>404</con:status><con:params/></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/xml</con:mediaType><con:status>200</con:status><con:params/><con:element>quote</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="QuoteStatusRequest" mediaType="application/json" id="7c600dae-d8ed-459e-94c9-d86d67116ebe"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/quote/task/12345</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="Q294415" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>id</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="quote-task" path="/quote/task/" id="ecd207c0-2062-4d42-ada4-d0036f124a72"><con:settings/><con:parameters/><con:method name="createQuote" method="POST" id="bed60d1f-b561-40d0-b44a-4ad0e04baf5f"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/xml</con:mediaType><con:params/><con:element>quote</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/xml</con:mediaType><con:status>200 202</con:status><con:params/><con:element>quote</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>404</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="CreateQuoteRequest" mediaType="application/xml" postQueryString="false" id="3bdb2577-0e4e-4cce-8edc-1095e3e97591"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8080</con:endpoint><con:request>&lt;quote>
    &lt;productIds>1,2,3&lt;/productIds>
&lt;/quote></con:request><con:originalUri>http://localhost/quote/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource></con:interface><con:testSuite name="QuotePollingTestSuite" id="ad69ad23-2362-43d2-82ce-5d68c6dd8934"><con:description>TestSuite generated for REST Service [http://localhost:8080]</con:description><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="QuotePollingTestCase" searchProperties="true" id="137161c0-c66b-41de-9339-54556b70377b"><con:settings/><con:testStep type="restrequest" name="POST createQuote" id="5fcd835b-7292-4722-8acc-991c4f656690"><con:settings/><con:config service="http://localhost:8080" resourcePath="/quote/task/" methodName="createQuote" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST createQuote" mediaType="application/xml" postQueryString="false" id="c2d781c5-11f6-452e-a066-2e7cbc4a4af0"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8080</con:endpoint><con:request>&lt;quote>
&lt;productIds>1,2,3&lt;/productIds>
&lt;/quote></con:request><con:originalUri>http://localhost/quote/</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="d9b72f94-d2e5-4575-9732-03f3ffcc7b64" name="Status Code Should Be 202"><con:configuration><codes>202
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="GET quoteStatus" id="868c659b-8564-4cd4-8bcc-39995e6dccca"><con:settings/><con:config service="http://localhost:8080" resourcePath="/quote/task/{id}" methodName="getQuoteStatus" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GET quoteStatus" mediaType="application/json" id="903dfc66-5020-4591-af74-c5bc50baf7d9"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/quote-status/Q725987</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="89580f62-3876-45ea-a744-b84b8cfc7207" name="Status Code Should Be 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${POST createQuote#Response#//quote-task[1]/id[1]}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="delay" name="Delay" id="a52b7b5f-7e7c-4550-81ea-eec806cc4612"><con:settings/><con:config><delay>5000</delay></con:config></con:testStep><con:testStep type="goto" name="Conditional Goto" id="0a27fa7c-363c-4a0b-aa21-be3db2d81205"><con:settings/><con:config xsi:type="con:GotoStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:condition><con:name>quoteStatus</con:name><con:type>XPATH</con:type><con:expression>//quote-task[1]/status[1] = 'PROCESSING'</con:expression><con:targetStep>GET quoteStatus</con:targetStep></con:condition></con:config></con:testStep><con:testStep type="restrequest" name="GET quote" id="3a95b7c0-ceed-45c4-8c2c-577e1cddd225"><con:settings/><con:config service="http://localhost:8080" methodName="getQuote" resourcePath="/quote/{id}" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GET quote" id="f39239f1-7f4a-45e9-97b2-1da56a35d213" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/</con:endpoint><con:request/><con:originalUri>http://localhost/quote/Q570319</con:originalUri><con:assertion type="XPath Match" id="5dfedb08-19bc-4117-a277-dcdaaa4e1d0e" name="Quote Amount Should Be 100"><con:configuration><path>//quote[1]/amount[1]</path><content>100</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${GET quoteStatus#Response#//quote-task[1]/id[1]}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:properties/><con:reportParameters/></con:testSuite><con:restMockService port="8080" path="/" host="bear-software-macpro.home" name="QuoteMockService" id="27154783-aacb-4c2d-80c8-d859308ad694"><con:settings/><con:startScript>context["quotes"]=[:]</con:startScript><con:properties/><con:restMockAction name="/quote/task/" method="GET" resourcePath="/quote/task/" id="333e01cb-8be0-4b87-8364-78fd1321991f"><con:settings/><con:defaultResponse xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">ProcessingStatusResponse</con:defaultResponse><con:dispatchStyle>SCRIPT</con:dispatchStyle><con:dispatchPath>def quoteNo = mockRequest.getPath().split("/")[-1]

log.info "quoteNo: " + quoteNo
log.info "context[quotes]: " + context["quotes"]

def quoteCompleteTime = context["quotes"][quoteNo]

log.info "quoteCompleteTime: " + quoteCompleteTime

if (quoteCompleteTime==null) return "QuoteNotFoundResponse"

requestContext["quoteNo"]=quoteNo

def nowTime=new Date()
if (nowTime>=quoteCompleteTime) return "CompleteStatusResponse" 
	else return "ProcessingStatusResponse"</con:dispatchPath><con:response name="ProcessingStatusResponse" httpResponseStatus="200" id="2eb87444-c613-422a-906e-017b0a5fcf93"><con:settings/><con:responseContent><![CDATA[<quote-task xmlns:atom="http://www.w3.org/2005/Atom">
    <id>${quoteNo}</id>
    <status>PROCESSING</status>
    <atom:link rel="self" href="http://localhost:8080/quote/task/${quoteNo}"/>
</quote-task>]]></con:responseContent></con:response><con:response name="CompleteStatusResponse" httpResponseStatus="200" id="f3c148bb-2afe-4372-ad09-bc9025b81015"><con:settings/><con:responseContent><![CDATA[<quote-task xmlns:atom="http://www.w3.org/2005/Atom">
    <id>${quoteNo}</id>
    <status>COMPLETE</status>
    <atom:link rel="self" href="http://localhost:8080/quote/task/${quoteNo}"/>
    <atom:link rel="quote" href="http://localhost:8080/quote/${quoteNo}"/>
</quote-task>]]></con:responseContent></con:response><con:response name="QuoteNotFoundResponse" httpResponseStatus="404" id="47bad621-1739-4593-9d20-0fdcf79ae0da"><con:settings/><con:responseContent>Quote not found.</con:responseContent></con:response></con:restMockAction><con:restMockAction name="/quote/task/" method="POST" resourcePath="/quote/task/" id="cdc809a1-6df6-4cf0-a724-d6319f485c26"><con:settings/><con:defaultResponse>ReturnQuoteStatusLinkResponse</con:defaultResponse><con:dispatchStyle>SCRIPT</con:dispatchStyle><con:dispatchPath>import groovy.time.TimeCategory

def quoteNo="Q${new Random().nextInt(1000000)}"
use ( TimeCategory ) {
	context["quotes"][quoteNo]=10.seconds.from.now
}
log.info "createQuote: " + context["quotes"][quoteNo]

requestContext["quoteNo"]=quoteNo</con:dispatchPath><con:response name="ReturnQuoteStatusLinkResponse" httpResponseStatus="202" id="2e53c311-91b5-4ad8-b2cf-5f87041c0ccc"><con:settings/><con:responseContent><![CDATA[<quote-task xmlns:atom="http://www.w3.org/2005/Atom">
    <id>${quoteNo}</id>
    <status>PROCESSING</status>
    <atom:link rel="self" href="http://localhost:8080/quote/task/${quoteNo}"/>
</quote-task>]]></con:responseContent></con:response></con:restMockAction><con:restMockAction name="/quote/" method="GET" resourcePath="/quote/" id="89cbb5e8-b888-4188-8693-920e188b7255"><con:settings/><con:defaultResponse>QuoteResponse</con:defaultResponse><con:dispatchStyle>SCRIPT</con:dispatchStyle><con:dispatchPath>def quoteNo = mockRequest.getPath().split("/")[-1]

log.info "quoteNo: " + quoteNo

def quoteCompleteTime = context["quotes"][quoteNo]

log.info "quoteCompleteTime: " + quoteCompleteTime

if (quoteCompleteTime==null) return "QuoteNotFoundResponse"

requestContext["quoteNo"]=quoteNo</con:dispatchPath><con:response name="QuoteResponse" httpResponseStatus="200" id="812f1b4b-930d-430c-8a66-df8be8665eee"><con:settings/><con:responseContent><![CDATA[<quote xmlns:atom="http://www.w3.org/2005/Atom">
    <id>${quoteNo}</id>
    <amount>100</amount>
    <atom:link rel="self" href="http://localhost:8080/quote/${quoteNo}"/>
</quote>]]></con:responseContent></con:response><con:response name="QuoteNotFoundResponse" httpResponseStatus="404" id="61a3c57f-9e3a-467e-98e5-735e5d0fb930"><con:settings/><con:responseContent>Quote not found.</con:responseContent></con:response></con:restMockAction></con:restMockService><con:requirements/><con:properties/><con:wssContainer/><con:databaseConnectionContainer/><con:oAuth2ProfileContainer/><con:reporting><con:xmlTemplates/><con:parameters/></con:reporting></con:soapui-project>