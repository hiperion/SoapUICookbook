<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="316364fd-f1a7-4e8a-8b68-406876b5a5be" activeEnvironment="Default" name="RESTContentNegotiation" resourceRoot="" soapui-version="5.0.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" id="c08e1426-9742-48d3-9e04-0a1ba7f3d234" wadlVersion="http://wadl.dev.java.net/2009/02" name="http://localhost:8989" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>http://bear-software-macpro.home:8089/</con:endpoint><con:endpoint>http://localhost:8989</con:endpoint></con:endpoints><con:resource name="Invoice" path="/invoice/{id}" id="dcbfe691-a41b-4848-b6bf-96e617f63441"><con:settings/><con:parameters><con:parameter><con:name>id</con:name><con:value/><con:style>TEMPLATE</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="Invoice" id="7b86a2eb-d991-4a3f-80aa-04186d890d31" method="GET"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>404</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>404</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:ns="http://localhost/contentneg/invoice/1234">ns:Response</con:element></con:representation><con:representation type="FAULT"><con:mediaType>text/xml</con:mediaType><con:status>404</con:status><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/xml</con:mediaType><con:status>200</con:status><con:params/><con:element>invoice</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="Request 1" id="983ebfd7-26fa-4405-8d52-fdb030393284" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8080/contneg</con:endpoint><con:request/><con:originalUri>http://localhost/contentneg/invoice/1234</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="123.xml" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>id</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="invoices" path="/invoices" id="558788cb-a12a-4da4-9783-d08cb87e5346"><con:settings/><con:parameters><con:parameter><con:name>size</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="Method 1" id="c078170b-702f-4e74-938b-5d06eef59532" method="GET"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>text/html; charset=iso-8859-1</con:mediaType><con:status>200</con:status><con:params/><con:element>html</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/xml</con:mediaType><con:status>200</con:status><con:params/></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>text/plain</con:mediaType><con:status>200</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType xsi:nil="true"/><con:status>500</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="Request 1" id="f0beb5f0-7936-489a-98fe-500451605503" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8089/</con:endpoint><con:request/><con:originalUri>http://localhost/invoices</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="size" value="2" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>size</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:testSuite name="ContentNegotiationTestSuite"><con:description>TestSuite generated for REST Service [http://localhost:8989]</con:description><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="RequestWithNoExtensionOrHeaderShouldProduceJSON"><con:settings/><con:config service="http://localhost:8989" methodName="Invoice" resourcePath="/invoice/{id}" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="RequestWithNoHeaderShouldProduceJSON" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://bear-software-macpro.home:8089/</con:endpoint><con:request/><con:originalUri>http://bear-software-macpro.home/invoice/1234</con:originalUri><con:assertion type="GroovyScriptAssertion" name="ShouldReturnJSON"><con:configuration><scriptText>assert messageExchange.response.contentType=="application/json"</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="1234" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="RequestWithNoExtensionAndApplicationXMLHeaderShouldProduceXML"><con:settings/><con:config service="http://localhost:8989" methodName="Invoice" resourcePath="/invoice/{id}" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="RequestWithNoExtensionAndApplicationXMLHeaderShouldProduceXML" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Accept" value="application/xml" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://bear-software-macpro.home:8089/</con:endpoint><con:request/><con:originalUri>http://bear-software-macpro.home/invoice/1234</con:originalUri><con:assertion type="GroovyScriptAssertion" name="XMLResponse"><con:configuration><scriptText>assert messageExchange.response.contentType=="application/xml"</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="1234" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="RequestWithNoExtensionAndTextXMLHeaderShouldProduceXML"><con:settings/><con:config service="http://localhost:8989" methodName="Invoice" resourcePath="/invoice/{id}" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="RequestWithNoExtensionAndTextXMLHeaderShouldProduceXML" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Accept" value="text/xml" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://bear-software-macpro.home:8089/</con:endpoint><con:request/><con:originalUri>http://bear-software-macpro.home/invoice/</con:originalUri><con:assertion type="GroovyScriptAssertion" name="XMLResponse"><con:configuration><scriptText>assert messageExchange.response.contentType=="application/xml"</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="1234" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="RequestWithNoExtensionAndTextPlainHeaderShouldProduceDefaultJSONResponse"><con:settings/><con:config service="http://localhost:8989" methodName="Invoice" resourcePath="/invoice/{id}" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="RequestWithNoExtensionAndTextPlainHeaderShouldProduceDefaultJSONResponse" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Accept" value="text/plain" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://bear-software-macpro.home:8089/</con:endpoint><con:request/><con:originalUri>http://bear-software-macpro.home/invoice/</con:originalUri><con:assertion type="GroovyScriptAssertion" name="JSONResponse"><con:configuration><scriptText>assert messageExchange.response.contentType=="application/json"</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="1234" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="RequestWithNoExtensionAndApplicationJSONHeaderShouldProduceJSON"><con:settings/><con:config service="http://localhost:8989" methodName="Invoice" resourcePath="/invoice/{id}" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="RequestWithNoExtensionAndApplicationJSONHeaderShouldProduceJSON" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Accept" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://bear-software-macpro.home:8089/</con:endpoint><con:request/><con:originalUri>http://bear-software-macpro.home/invoice/</con:originalUri><con:assertion type="GroovyScriptAssertion" name="JSONResponse"><con:configuration><scriptText>assert messageExchange.response.contentType=="application/json"</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="1234" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="RequestWithJSONExtensionShouldProduceJSON"><con:settings/><con:config service="http://localhost:8989" methodName="Invoice" resourcePath="/invoice/{id}" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="RequestWithJSONExtensionShouldProduceJSON" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://bear-software-macpro.home:8089/</con:endpoint><con:request/><con:originalUri>http://bear-software-macpro.home/invoice/1234.json</con:originalUri><con:assertion type="GroovyScriptAssertion" name="JSONResponse"><con:configuration><scriptText>assert messageExchange.response.contentType=="application/json"</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="1234.json" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="RequestWithXMLExtensionShouldProduceXML"><con:settings/><con:config service="http://localhost:8989" methodName="Invoice" resourcePath="/invoice/{id}" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="RequestWithXMLExtensionShouldProduceXML" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://bear-software-macpro.home:8089/</con:endpoint><con:request/><con:originalUri>http://bear-software-macpro.home/invoice/1234.xml</con:originalUri><con:assertion type="GroovyScriptAssertion" name="XMLResponse"><con:configuration><scriptText>assert messageExchange.response.contentType=="application/xml"</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="1234.xml" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:restMockService id="c6dde5b5-7454-4322-8531-6b0878a709c7" port="8089" path="/" host="bear-software-macpro.home" name="RESTContentSelectionMock"><con:settings/><con:properties/><con:restMockAction name="/invoice/" method="GET" resourcePath="/invoice/" id="1baf0362-4e15-4a03-baac-660934062689"><con:settings/><con:defaultResponse>JSON Response</con:defaultResponse><con:dispatchStyle>SCRIPT</con:dispatchStyle><con:dispatchPath>def requestPath = mockRequest.getPath()
def acceptHeader = mockRequest.getRequestHeaders().get("Accept")
log.info "Path: "+ requestPath
log.info "Accept Header: "+acceptHeader

if (requestPath ==~ /\/invoice\/555|\/invoice\/555.xml|\/invoice\/555.json/) {
	log.info "Matched invoice not found."
	return "Response 404"
}

if (requestPath.endsWith(".json") || acceptHeader?.contains("application/json"))
{
	log.info "Matched JSON"
    	return "JSON Response"    	
}
else if (requestPath.endsWith(".xml") || acceptHeader?.contains("application/xml") 
		|| acceptHeader?.contains("text/xml"))
{
	log.info "Matched XML"
  	return "XML Response"
}
log.info "No match - returning default"
</con:dispatchPath><con:response name="JSON Response" id="a06cc20c-77a1-4af5-aa4f-92942b0d6353" httpResponseStatus="200" mediaType="application/json"><con:settings/><con:responseContent>{"invoice": {
 "id": 123,
 "companyName": "Test Company",
 "amount": 555
}}
</con:responseContent></con:response><con:response name="XML Response" id="5daa7891-c587-47c5-b5bf-e2f901ae1e5e" httpResponseStatus="200"><con:settings/><con:responseContent><![CDATA[<invoice>
 <invoiceNo>123</invoiceNo>
 <company>Test Company</company>
 <amount>555</amount>
</invoice>]]></con:responseContent></con:response><con:response name="Response 404" id="d57a1a63-44a3-4dc9-ae1e-c3e37cae93bf" httpResponseStatus="404" mediaType="text/xml"><con:settings/><con:responseContent>Invoice number 555 was not found.</con:responseContent></con:response></con:restMockAction><con:restMockAction name="/invoices" method="GET" resourcePath="/invoices" id="38cc74e0-c029-4d23-a0d2-6babb7d9b11e"><con:settings/><con:defaultResponse>Dynamic Response</con:defaultResponse><con:dispatchStyle>SEQUENCE</con:dispatchStyle><con:dispatchPath>/*
// Script dispatcher is used to select a response based on the incoming request.
// Here are few examples showing how to match based on path, query param, header and body

// Match based on path
def requestPath = mockRequest.getPath()
log.info "Path: "+ requestPath

if( requestPath.contains("json") )
{
    // return the name of the response you want to dispatch
    return "JSON Response"
}


// Match based on query parameter
def queryString = mockRequest.getRequest().getQueryString()
log.info "QueryString: " + queryString

if( queryString.contains("stockholm") )
{
    // return the name of the response you want to dispatch
    return "Response Stockholm"
}
else if( queryString.contains("london") )
{
    // return the name of the response you want to dispatch
    return "Response London"
}


// Match based on header
def acceptEncodingHeaderList = mockRequest.getRequestHeaders().get("Accept-Encoding")
log.info "AcceptEncoding Header List: " + acceptEncodingHeaderList

if( acceptEncodingHeaderList.contains("gzip,deflate") )
{
    // return the name of the response you want to dispatch
    return "GZiped Response"
}


// Match based on body
def requestBody = mockRequest.getRequestContent()
log.info "Request body: " + requestBody

if( requestBody.contains("some data") )
{
    // return the name of the response you want to dispatch
    return "Response N"
}
*/
</con:dispatchPath><con:response name="Dynamic Response" id="3a45aa2b-7ed0-4184-a7eb-394338f2a19c" httpResponseStatus="200"><con:settings/><con:script>def queryString = mockRequest.getRequest().getQueryString()
int size = queryString.split("=")[1].toInteger()
log.info size
def invoices = []
size.times {
     invoices &lt;&lt; ["invoice":["id":"$it","company":"test $it","amount":"10$it"]]
}
def invoicesMap=["invoices":invoices] 
    
def builder = new groovy.json.JsonBuilder(invoicesMap)

mockResponse.responseContent=builder.toPrettyString()
mockResponse.responseHttpStatus=200
def headers = mockResponse.responseHeaders
headers["Content-Type"]=["application/json"]
mockResponse.responseHeaders=headers
</con:script><con:responseContent>{
    "invoices": [
        {
            "invoice": {
                "id": "0",
                "company": "test 0",
                "amount": "100"
            }
        },
        {
            "invoice": {
                "id": "1",
                "company": "test 1",
                "amount": "101"
            }
        }
    ]
}</con:responseContent><con:header><con:name>Content-Type</con:name><con:value>application/json</con:value></con:header></con:response></con:restMockAction></con:restMockService><con:requirements/><con:properties/><con:wssContainer/><con:databaseConnectionContainer/><con:oAuth2ProfileContainer/><con:reporting><con:xmlTemplates/><con:parameters/></con:reporting><con:sensitiveInformation/></con:soapui-project>